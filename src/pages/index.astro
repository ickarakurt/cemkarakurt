---
import Card from "@components/Card";
import Footer from "@components/Footer.astro";
import Header from "@components/Header.astro";
import LinkButton from "@components/LinkButton.astro";
import Socials from "@components/Socials.astro";
import Tag from "@components/Tag.astro";
import { SITE, SOCIALS } from "@config";
import Layout from "@layouts/Layout.astro";
import getSortedContent from "@utils/getSortedContent";
import getUniqueTags from "@utils/getUniqueTags";
import { getCollection } from "astro:content";

const posts = await getCollection("blog");
const notes = await getCollection("note");

const sortedPosts = getSortedContent(posts);
const sortedContent = getSortedContent([...posts, ...notes]);
const featuredPosts = sortedContent.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);

const tags = getUniqueTags(posts);
const socialCount = SOCIALS.filter(social => social.active).length;
---

<Layout>
  <Header />

  <div class="mx-auto max-w-7xl px-4 lg:px-8">
    <div class="flex flex-col lg:flex-row gap-12 lg:gap-16 py-8 lg:py-12">
      {/* Sidebar - Technical aesthetic */}
      <aside
        class="lg:w-72 flex-shrink-0 space-y-10 lg:sticky lg:top-8 lg:self-start lg:max-h-[calc(100vh-4rem)] lg:overflow-y-auto"
      >
        {/* Profile Widget - Terminal-inspired */}
        <div class="space-y-6">
          <div class="space-y-5">
            <div class="flex items-start gap-3">
              <span class="mono-accent shrink-0 mt-1 text-xs opacity-50"
                >01</span
              >
              <div class="space-y-2">
                <h1
                  class="font-display text-3xl lg:text-4xl font-bold tracking-tight text-skin-base leading-tight"
                >
                  Cem Karakurt
                </h1>
                <p
                  class="text-skin-accent font-mono text-xs uppercase tracking-widest"
                >
                  Senior Full Stack Engineer
                </p>
              </div>
            </div>

            <div class="pl-7 space-y-3">
              <p
                class="text-skin-base/70 text-sm leading-relaxed border-l border-skin-border/40 pl-4"
              >
                Specializing in <span class="text-skin-base font-medium"
                  >distributed systems</span
                > & <span class="text-skin-base font-medium"
                  >micro-frontends</span
                >.
              </p>
            </div>

            <div class="pl-7">
              <div
                class="flex items-center gap-1.5 text-xs text-skin-base/50 font-mono"
              >
                <svg
                  class="w-3 h-3"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                >
                  <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                </svg>
                <span>Berlin, DE</span>
              </div>
            </div>
          </div>

          {socialCount > 0 && <Socials centered />}

          <div class="flex items-center gap-2 pl-7">
            <a
              href="/rss.xml"
              class="group inline-flex items-center gap-1.5 text-xs font-mono text-skin-base/50 hover:text-skin-accent transition-colors"
            >
              <svg
                class="w-3 h-3"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
              >
                <path d="M4 11a9 9 0 0 1 9 9"></path>
                <path d="M4 4a16 16 0 0 1 16 16"></path>
                <circle cx="5" cy="19" r="1"></circle>
              </svg>
              <span>Subscribe</span>
            </a>
          </div>
        </div>

        {/* Tags Widget - Data-inspired */}
        <div class="space-y-3">
          <div class="flex items-center gap-2">
            <span class="mono-accent text-xs opacity-50">02</span>
            <h2
              class="font-display text-xs font-medium uppercase tracking-wider text-skin-base/60"
            >
              Topics
            </h2>
          </div>
          <ul class="flex flex-wrap gap-1.5 pl-6">
            {
              tags.slice(0, 15).map((tag, index) => (
                <li
                  class="stagger-in"
                  style={`animation-delay: ${index * 0.05}s`}
                >
                  <Tag tag={tag.tagName} size="sm" />
                </li>
              ))
            }
          </ul>
          <div class="pt-1 pl-6">
            <a
              href="/tags"
              class="text-xs text-skin-base/60 hover:text-skin-accent transition-colors inline-flex items-center gap-1"
            >
              <span>View all</span>
              <svg
                class="w-3 h-3"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
              >
                <path d="M5 12h14M12 5l7 7-7 7"></path>
              </svg>
            </a>
          </div>
        </div>
      </aside>

      {/* Main Content - Asymmetric layout */}
      <main id="main-content" class="flex-1 min-w-0 space-y-14">
        {/* Featured Section */}
        {
          featuredPosts.length > 0 && (
            <section class="space-y-5">
              <div class="flex items-center gap-3 border-b border-skin-border/40 pb-2.5">
                <span class="mono-accent text-xs opacity-50">featured</span>
                <h2 class="font-display text-lg font-semibold text-skin-base tracking-tight">
                  Selected Work
                </h2>
              </div>
              <ul class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-4">
                {featuredPosts.map((post, index) => (
                  <li
                    class="stagger-in"
                    style={`animation-delay: ${index * 0.1}s`}
                  >
                    <Card
                      collection={post.collection}
                      href={`/${post.collection === "blog" ? "blog" : "notes"}/${post.id}/`}
                      frontmatter={post.data}
                      secHeading={false}
                    />
                  </li>
                ))}
              </ul>
            </section>
          )
        }

        {/* Recent Posts Section */}
        {
          recentPosts.length > 0 && (
            <section class="space-y-5">
              <div class="flex items-center justify-between border-b border-skin-border/40 pb-2.5">
                <div class="flex items-center gap-3">
                  <span class="mono-accent text-xs opacity-50">recent</span>
                  <h2 class="font-display text-lg font-semibold text-skin-base tracking-tight">
                    Latest Writings
                  </h2>
                </div>
                <LinkButton
                  href="/blog/"
                  className="text-sm text-skin-base/60 hover:text-skin-accent transition-colors inline-flex items-center gap-1"
                >
                  <span>View all</span>
                  <svg
                    class="w-3.5 h-3.5"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                  >
                    <path d="M5 12h14M12 5l7 7-7 7" />
                  </svg>
                </LinkButton>
              </div>

              <ul class="space-y-2">
                {recentPosts.map(
                  ({ data, id }, index) =>
                    index < SITE.postPerIndex && (
                      <li
                        class="stagger-in group"
                        style={`animation-delay: ${(index + 3) * 0.06}s`}
                      >
                        <a
                          href={`/blog/${id}/`}
                          class="flex items-center gap-4 p-3 rounded-lg bg-skin-card border border-skin-border/40 hover:border-skin-accent/30 hover:bg-skin-card-muted transition-all duration-300 magnetic-hover"
                        >
                          <span class="font-mono text-xs text-skin-base/30 shrink-0 tabular-nums">
                            {String(index + 1).padStart(2, "0")}
                          </span>
                          <span class="flex-1 text-sm font-medium text-skin-base group-hover:text-skin-accent transition-colors">
                            {data.title}
                          </span>
                          <span class="text-xs text-skin-base/40 font-mono shrink-0 tabular-nums">
                            {data.pubDatetime.toLocaleDateString("en-US", {
                              month: "short",
                              day: "numeric",
                              year: "numeric",
                            })}
                          </span>
                        </a>
                      </li>
                    )
                )}
              </ul>
            </section>
          )
        }
      </main>
    </div>
  </div>

  <Footer />

  <style>
    /* Custom scrollbar for sidebar */
    aside::-webkit-scrollbar {
      width: 4px;
    }
    aside::-webkit-scrollbar-track {
      background: transparent;
    }
    aside::-webkit-scrollbar-thumb {
      background: rgba(var(--color-accent), 0.2);
      border-radius: 2px;
    }
    aside::-webkit-scrollbar-thumb:hover {
      background: rgba(var(--color-accent), 0.4);
    }
  </style>
</Layout>
